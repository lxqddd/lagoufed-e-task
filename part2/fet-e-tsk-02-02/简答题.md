## Webpack 的构建流程主要有哪些环节？如果可以请尽可能详尽的描述 Webpack 打包的整个过程

1. 初始化参数，即通过命令行(或者配置文件)中的参数进行合并，得到最终打包命令的最后参数
2. 开始编译：通过前面的参数初始化一个Compiler对象，并加载我们所需要的所有的loader，并执行Compiler对象的run方法来执行编译过程
3. 确定入口：通过webpack.config.js中的entry(或者我们自己在命令行中指定)，找到我们的入口文件
4. 编译模块：通过我们刚才的入口文件进行递归，找到每个模块的依赖，并调用我们指定的loader进行编译，直到所有依赖都被编译完成
5. 完成模块编译：得到了每个模块最后编译的结果已经他们之间的依赖关系
6. 输出资源：这一步是把我们刚才得到的文件通过他们之间的依赖关系来组成一个一个的chunk，再把每个chunk输出到文件上（这也是最后可以对输出内容进行更改的地方）
7. 输出完成：根据配置确定输出的路径和文件名，把文件内容写入到文件中

> 在上面的过程中，webpack会在特定的时间广播特定的事件，插件会监听这些事件，并在监听到的事件中执行自己的逻辑，然后调用webpack提供的api来把修改过的内容返回回去

## Loader 和 Plugin 有哪些不同？请描述一下开发 Loader 和 Plugin 的思路。

- Loder

  > loder在webpack中提供的是编译和转换代码的功能

- Plugin

  > Plugin是用于完成loader无法完成的事情，通常都是通过监听webpack的生命周期，然后执行自己的逻辑，并将最后的结果通过调用webpack的api返回回去

#### 2.1、Loader开发

由于webpack是是运行在nodejs上的，所以loader其实就是一个Node.js模块，这个模块需要导出一个函数，这个函数的作用就是获得处理前的内容，对内容进行转换处理，并把处理后的内容返回回去。代码类似下面这样

```js
module.exports=(source)=>{
 // 做一些处理操作,然后把处理完成之后结果返回回去
 // 当然在这个里面，我们也是可以引入第三方模块来进行处理，方法就和平时的nodejs写法相同
 const result = source;
 return result;
}
```

#### 2.2、Plugin开发

由于webpack工作中有很多环节，并且webpack给每个环节都埋下了钩子（个人感觉也可以理解成生命周期），我们开发插件的时候只需要通过这些钩子来触发相应的任务就可以了。webpack中也规定了，plugin必须是一个函数或者一个包含apply的对象。一个简单的插件实现，如下所示

```js
class MyPlugin{
  // 传入相应的配置信息
  constructor(options){

  }

  // 将Compiler对象传递进来
  // 然后通过这个对象来注册钩子函数
  apply(compiler){
    // 注册emit钩子方法
    // compilation是一个上下文,
    compiler.hooks.emit.tap("MyPlugin",compilation=>{
      //在这里执行我们的方法来修改内容
    })
  }
}
```